<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta name="description" content="Code, design, systems">
    <title>blog.iyue.club - php-array-splice</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/core.css" />
    <link rel="image_src" href="../favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="iyue.club" href="../rss.xml" />

  </head>
  <body>
    <div class="container">
      <div class="row head">
        <div class="col-lg-8 col-lg-offset-2">
          <div class="page-header">
            <h1>
              <a href="../">blog.iyue.club
              </a>
            </h1>
          </div>
          <ul class="nav nav-pills header">
            <li>
              <a href="../">Home</a>
            </li>
            <li>
              <a href="../archive.html">Archives</a>
            </li>
            <li>
              <a href="../about.html">About</a>
            </li>
            <li>
              <a href="../rss.xml">RSS</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="row content">
        <div class="col-lg-8 col-lg-offset-2">
          <div class="post">
  <article>
    <header>
      <h2 class="post-title">php-array-splice</h2>
      <p class="metadata">
        <span class="date">September  2, 2014</span> - <span class="tags"><a href="../tags/php.html">php</a></span>
      </p>
    </header>
    <p>昨天下午接到一个任务是从一堆数据中去掉指定的数据。需求很简单，本来很快就能做完，但是到后来发现了 一个bug让我百思不得其解，今天早上来上班之后突然头脑清醒了把问题发现了。</p>
<p>我的思路是把要过滤的数据都放到一个叫做<code>$filterGames</code>的数组里面，所有的数据存放在<code>$arr</code>这个数组里。 因为要用php实现，没有现成的方法，随便写了一个线性复杂度的算法，挨个检测<code>in_array</code>，然后用<code>array_splice</code>这个 函数来删除元素。本来思路是很简单的，但是就是得不到我要的结果。具体代码如下： <code> foreach($arr as $k =&gt; <span class="math inline">$v) {  if(in_array($</span>v, <span class="math inline">$filterGames)) {  array_splice($</span>arr, $k, 1) } } return $arr; </code> 结果总是过滤了部分数据但是还有部分不能过滤。</p>
<p>今天发现问题之后我改了一下，用的是<code>unset</code>这个方法。 <code> foreach($arr as $k =&gt; <span class="math inline">$v) {  if(in_array($</span>v, <span class="math inline">$filterGames)) {  unset($</span>arr[$k]); } } </code> 本来我应该用array_splice来删除数组元素的，因为这个方法不会在数组中留下一个洞，而unset把元素删了之后会留下一个洞，导致 没法通过数组的key来遍历。至于为什么array_splice只能过滤部分数据而unset可以全部过滤掉也是因为当使用array_splice的时候 删了一个元素后面的元素会往前面挤，导致错过了被删的机会。而unset则是删了一个元素之后就留出了一个洞，整个数组的结构不变。 我觉得php的数组应该是用链表来实现的，在每个节点中有一个字段记录了当前节点相对于首节点的位置，如果用array_splice来删除 节点，会重写每个节点的这个相对位置，而用unset来删除则不会。</p>
<p>不过作为上层应用开发者对于语言的具体实现不必要去研究，只要形象的知道这2种方法的不同就够了。</p>
  </article>
</div>
        </div>
      </div>
      <div class="row footer">
        <div class="col-lg-8 col-lg-offset-2">
          <div class="bottom">
            Generated using <a href="http://jaspervdj.be/hakyll/">Hakyll</a>. Source available on <a href="https://github.com/xcaptain/xcaptain.github.io">GitHub</a>.
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
